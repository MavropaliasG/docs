<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GCE vs other Kubernetes clusters | WBStack Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Documentation site for WBStack">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/docs/assets/css/0.styles.fde12c9a.css" as="style"><link rel="preload" href="/docs/assets/js/app.02a1a363.js" as="script"><link rel="preload" href="/docs/assets/js/2.66139f8f.js" as="script"><link rel="preload" href="/docs/assets/js/15.d09e7ee9.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.966c6ed7.js"><link rel="prefetch" href="/docs/assets/js/11.c6985d45.js"><link rel="prefetch" href="/docs/assets/js/12.b687c70f.js"><link rel="prefetch" href="/docs/assets/js/13.e67ca8ad.js"><link rel="prefetch" href="/docs/assets/js/14.de616b79.js"><link rel="prefetch" href="/docs/assets/js/16.73a29a76.js"><link rel="prefetch" href="/docs/assets/js/17.b3a67950.js"><link rel="prefetch" href="/docs/assets/js/18.07030d45.js"><link rel="prefetch" href="/docs/assets/js/19.2165f77a.js"><link rel="prefetch" href="/docs/assets/js/20.931c1f3d.js"><link rel="prefetch" href="/docs/assets/js/21.10eb2b67.js"><link rel="prefetch" href="/docs/assets/js/22.9b3f3e4e.js"><link rel="prefetch" href="/docs/assets/js/23.b2468301.js"><link rel="prefetch" href="/docs/assets/js/24.d18b49db.js"><link rel="prefetch" href="/docs/assets/js/25.f45e70af.js"><link rel="prefetch" href="/docs/assets/js/26.6240acc4.js"><link rel="prefetch" href="/docs/assets/js/27.a611d0c8.js"><link rel="prefetch" href="/docs/assets/js/28.116ce040.js"><link rel="prefetch" href="/docs/assets/js/29.a5b94c2f.js"><link rel="prefetch" href="/docs/assets/js/3.1183e6c1.js"><link rel="prefetch" href="/docs/assets/js/30.aea2fa8d.js"><link rel="prefetch" href="/docs/assets/js/31.c2de855b.js"><link rel="prefetch" href="/docs/assets/js/32.65f63d4b.js"><link rel="prefetch" href="/docs/assets/js/33.7c61cff8.js"><link rel="prefetch" href="/docs/assets/js/34.d734c5cf.js"><link rel="prefetch" href="/docs/assets/js/35.02ccbd28.js"><link rel="prefetch" href="/docs/assets/js/36.6313a777.js"><link rel="prefetch" href="/docs/assets/js/37.1be35129.js"><link rel="prefetch" href="/docs/assets/js/38.ea58bf02.js"><link rel="prefetch" href="/docs/assets/js/39.13a537f3.js"><link rel="prefetch" href="/docs/assets/js/4.17fc98ba.js"><link rel="prefetch" href="/docs/assets/js/40.0cea1395.js"><link rel="prefetch" href="/docs/assets/js/41.556ad920.js"><link rel="prefetch" href="/docs/assets/js/42.b38362f6.js"><link rel="prefetch" href="/docs/assets/js/43.69e9110f.js"><link rel="prefetch" href="/docs/assets/js/44.cdd36687.js"><link rel="prefetch" href="/docs/assets/js/45.03718058.js"><link rel="prefetch" href="/docs/assets/js/46.2df326e7.js"><link rel="prefetch" href="/docs/assets/js/47.c139d675.js"><link rel="prefetch" href="/docs/assets/js/48.c9d936d4.js"><link rel="prefetch" href="/docs/assets/js/49.2d182955.js"><link rel="prefetch" href="/docs/assets/js/5.e09880be.js"><link rel="prefetch" href="/docs/assets/js/50.eec185ea.js"><link rel="prefetch" href="/docs/assets/js/51.1d8db3c0.js"><link rel="prefetch" href="/docs/assets/js/52.5c9d7f9c.js"><link rel="prefetch" href="/docs/assets/js/53.525a77d9.js"><link rel="prefetch" href="/docs/assets/js/54.f405cfbd.js"><link rel="prefetch" href="/docs/assets/js/55.63e71554.js"><link rel="prefetch" href="/docs/assets/js/56.c43dfeaa.js"><link rel="prefetch" href="/docs/assets/js/57.42594837.js"><link rel="prefetch" href="/docs/assets/js/58.09fad31a.js"><link rel="prefetch" href="/docs/assets/js/6.d6760fe0.js"><link rel="prefetch" href="/docs/assets/js/7.6ed141c6.js"><link rel="prefetch" href="/docs/assets/js/8.85d78c91.js"><link rel="prefetch" href="/docs/assets/js/9.e9a4d3a0.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.fde12c9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">WBStack Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/docs/tech/" class="nav-link router-link-active">
  Technology
</a></div><div class="nav-item"><a href="/docs/users/" class="nav-link">
  Users
</a></div><div class="nav-item"><a href="https://www.wbstack.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WBStack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.github.com/wbstack" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/docs/tech/" class="nav-link router-link-active">
  Technology
</a></div><div class="nav-item"><a href="/docs/users/" class="nav-link">
  Users
</a></div><div class="nav-item"><a href="https://www.wbstack.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WBStack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.github.com/wbstack" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>General</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Cloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Services</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Decision Records</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/tech/decisions/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/docs/tech/decisions/0000-gce-vs-other-k8s-cluster.html" aria-current="page" class="active sidebar-link">GCE vs other Kubernetes clusters</a></li><li><a href="/docs/tech/decisions/0001-gce-kubernetes-cluster-private-vs-public.html" class="sidebar-link">Private vs Public GCE kubernetes cluster</a></li><li><a href="/docs/tech/decisions/0002-gce-ingress-vs-nginx.html" class="sidebar-link">GCE Ingress vs Nginx</a></li><li><a href="/docs/tech/decisions/0003-vitess-vs-mysql.html" class="sidebar-link">Vitess vs Mysql / Mariadb</a></li><li><a href="/docs/tech/decisions/0004-one-wdqs-vs-cluster.html" class="sidebar-link">One WDQS server vs a cluster</a></li><li><a href="/docs/tech/decisions/0005-backend-apis-and-services.html" class="sidebar-link">Backend APIs and Services</a></li><li><a href="/docs/tech/decisions/0006-wiki-access.html" class="sidebar-link">Public access of Wikis</a></li><li><a href="/docs/tech/decisions/0008-custom-domains-ingress-creation.html" class="sidebar-link">Custom domain ingress creation</a></li><li><a href="/docs/tech/decisions/tba-api-using-laravel.html" class="sidebar-link">API in Laravel</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="gce-vs-other-kubernetes-clusters"><a href="#gce-vs-other-kubernetes-clusters" class="header-anchor">#</a> GCE vs other Kubernetes clusters</h1> <p><strong>Date:</strong> Prior to 27 August 2019</p> <p><strong>Problem:</strong></p> <p>There are multiple different options for a Kubernetes cluster.
They have different costs, locking and acceptance in Wikimedia flavoured world (free and open).</p> <p><strong>Decision:</strong></p> <ul><li>Use Google Kubernetes Engine for the alpha version of the service.</li> <li>Create services primarily within Kubernetes, with as little binding to external services as possible.</li> <li>This allows fastest speed for Alpha with more flexibility possible in the future. (For example moving to servers owned by another
org (depending on the future direction of this project)).</li></ul> <h2 id="options"><a href="#options" class="header-anchor">#</a> Options</h2> <p>Many options were considered for the initial hosting location of the alpha version.</p> <h3 id="raspberry-pis"><a href="#raspberry-pis" class="header-anchor">#</a> Raspberry Pis</h3> <p>I actually started working on this project planning to have a mini cluster of PIs up throughtout development work.
This ended up not making much sense because of differing architecture types etc..</p> <h3 id="bare-metal-vms"><a href="#bare-metal-vms" class="header-anchor">#</a> &quot;Bare Metal&quot; VMs</h3> <p>On Wikimedia Cloud VPS I experimented with setting up a <a href="https://phabricator.wikimedia.org/T196094" target="_blank" rel="noopener noreferrer">custom cluster on a project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The main issues with this approach is the overhead when dealing with the fact that certain things that come for free in public clouds are not provided by default in this custom environment:</p> <ul><li><strong>LoadBalancer / Ingress</strong>: It's possible to partly work around this (detailed in blog post) by making a single node have a static IP and serve as the host for the ingress.</li> <li><strong>Persistent cross node storage</strong>: A storage provider for the shared NFS services could be used, this would likely be slow for things such as SQL. Or some cloud native storage service could be used, but could be effort.</li></ul> <h4 id="manual-setup"><a href="#manual-setup" class="header-anchor">#</a> Manual Setup</h4> <p>The workflow for creating a simple Kubernetes cluster by hand are documented in <a href="https://addshore.com/2018/04/from-0-to-kubernetes-cluster-on-custom-vms/" target="_blank" rel="noopener noreferrer">this blog post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Although this worked, this left me to do a lot of manual maintenance of the cluster.
The point of the Alpha is not to maintain a Kubernetes cluster, but prove that the concept of Wikibase as a service works.</p> <h4 id="kubespray"><a href="#kubespray" class="header-anchor">#</a> KubeSpray</h4> <p><a href="https://github.com/kubernetes-sigs/kubespray" target="_blank" rel="noopener noreferrer">KubeSpray<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> was super slow and annoying removing the cluster and recreating it which I was doing lots during development, this seemed like a bad idea.</p> <h3 id="google-kubernetes-engine"><a href="#google-kubernetes-engine" class="header-anchor">#</a> Google Kubernetes Engine</h3> <p>Testing work was started on GKE as it was the easiest place to get a cluster up and running in a few minutes.
It also allowed total cluster destruction and recreation in a few minutes.
During development I also managed to make use of a free credit offer.</p> <p>GKE has the advantage of being able to make use of <a href="https://cloud.google.com/preemptible-vms/" target="_blank" rel="noopener noreferrer">pre-emptible nodes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which come and go as they please, but reduce costs.
A service can be used to make using these nodes with Kubernetes rather painless (<a href="https://cloud.google.com/blog/products/containers-kubernetes/cutting-costs-with-google-kubernetes-engine-using-the-cluster-autoscaler-and-preemptible-vms" target="_blank" rel="noopener noreferrer">read more<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>One downside of staying with GKE is that the bandwidth egress is billed and could end up being a big cost much further down the line.</p> <h3 id="fuga-io"><a href="#fuga-io" class="header-anchor">#</a> Fuga.io</h3> <p>This could be a nice host to move to suggested by Andra.
But setting up a Kubernetes cluster there is somewhat involved.
https://docs.fuga.cloud/how-to-deploy-kubernetes-on-fuga-cloud
This is similar to the steps needs to setup k8s on any random collection of servers.</p> <p>One plus is traffic is included.
The pricing is also pretty comparable to GKE.
There are no pre-emptible instances though. 😦</p> <p>I do still have some voucher codes in my emails for this service somewhere.</p> <h3 id="kubermatic-container-engine"><a href="#kubermatic-container-engine" class="header-anchor">#</a> Kubermatic Container Engine</h3> <p>I was also emailing with &quot;Kubermatic Container Engine&quot; and a guy called Bill suggested that
I look at a thing called KubeOne that they recently open sourced.
https://github.com/kubermatic/kubeone</p> <p>It looks like it has promise, but again I don't want to waste time there now, best stay with GCE.</p> <h3 id="other-large-clouds"><a href="#other-large-clouds" class="header-anchor">#</a> Other large clouds</h3> <p>There are lots of other cloud providers that I could look into, Azure, Amazon, DigitalOcean etc.
Google seems the least evil perhaps?</p> <p>Other reasons include:</p> <ul><li>Pre-emptive instances being cheaper (and I plan to use these..)</li> <li>More familiarity with the interface commands etc.</li> <li>I'm not planning on using any cloud hoster features other than the k8s cluster itself a load balancer and maybe a bit of CDN (which I could also do on Kubernetes) so there is no real lock in and switching down the road should be easy enough.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/wbstack/docs/edit/main/tech/decisions/0000-gce-vs-other-k8s-cluster.md" target="_blank" rel="noopener noreferrer">Edit this page on Github!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/2/2021, 9:47:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/tech/decisions/" class="prev router-link-active">
        Overview
      </a></span> <span class="next"><a href="/docs/tech/decisions/0001-gce-kubernetes-cluster-private-vs-public.html">
        Private vs Public GCE kubernetes cluster
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.02a1a363.js" defer></script><script src="/docs/assets/js/2.66139f8f.js" defer></script><script src="/docs/assets/js/15.d09e7ee9.js" defer></script>
  </body>
</html>
